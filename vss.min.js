/*
vss 2014-10-15 dcd47dfb764fbf8343dd22d6c0234e654879d252

Visit https://greglu.github.io/vss for license and more information
*/
!function(){function a(a){function b(){var a=$('<div class="paulund_block_page"></div>');a.click(function(a){a.stopImmediatePropagation(),$(this).fadeOut().remove()}),a.appendTo("body")}function c(){var a=$('<div class="paulund_modal_box"><a href="#" class="paulund_modal_close"></a><div class="paulund_inner_modal_box"><h2>'+d.title+"</h2>"+d.description+"</div></div>");a.click(function(a){a.stopPropagation()}),a.appendTo(".paulund_block_page"),$(".paulund_modal_close").click(function(){$(this).parent().fadeOut().remove(),$(".paulund_block_page").fadeOut().remove()})}var d=$.extend({title:"Share Your Design",description:""},a);return b(),c(),$(".paulund_modal_box").fadeIn(),this}function b(){return $&&"localStorage"in window&&null!==window.localStorage?0===t.length||0===w.length?!1:!0:!1}function c(a){return a&&0===a.indexOf(s)?a.substring(s.length,a.length):a}function d(a){return s+c(a)}function e(a){if(a){var b=$(a),c=b[0];if(b.triggerHandler("change"),b.parents(v)){var d=$.Event("change");d.target=c,w.trigger(d)}}}function f(){var a=[];$.each(u.find("input:checked"),function(b,c){a.push(c.id)});var b={};$.each(u.find("input[type=text],textarea"),function(a,c){c.value&&(b[c.id]=c.value)});var c={};$.each(u.find("select"),function(a,b){var d=$(b).find("option:selected").val();d&&(c[b.id]=d)});var d={checkedItems:a,textItems:b,selectedOptionItems:c};return JSON.stringify(d)}function g(a,b){a&&(a=b?a:JSON.parse(a),a&&($.each(u.find("input[type=text],textarea"),function(a,b){$(b).val("")}),$.each(u.find("input:checked"),function(a,b){$(b).prop("checked",!1)}),$.each(u.find("select[id!="+x+"]"),function(a,b){b.selectedIndex=0,e(b)}),$.each(a.textItems,function(a,b){$("#"+a).val(b)}),$.each(a.checkedItems,function(a,b){var c=$("#"+b);c&&(c.prop("checked",!0),e(c))}),$.each(a.selectedOptionItems,function(a,b){var c=$("#"+a);c&&(c.val(b),e(c))}),vsuit.calc()))}function h(){var a=[];return $.map(localStorage,function(b,d){0===d.indexOf(s)&&a.push(c(d))}),a}function i(a){if(a){var b=d(a),c=localStorage.getItem(b);c?g(c):console.log("No saved design found for name: "+a)}}function j(a){return a?(console.log("Saving: "+d(a)),localStorage.setItem(d(a),f()),!0):!1}function k(a){a&&localStorage.removeItem(d(a))}function l(a){var b=$("<select>Load Design</select>").attr("id",a);return b.append($("<option>",{value:"",selected:"selected"}).text("-- Load Saved Design --")),$.each(h(),function(a,c){m(b,c)}),b.change(function(){var a=$(this).find(":selected").val();return a&&(console.log("Loading design: "+a),i(a)),!1}),b}function m(a,b){b&&a.append($("<option>",{value:b}).text(b))}function n(a){var b=$("<button>Delete</button>");return b.click(function(){var b=a.find(":selected").val();return b&&confirm("Are you sure you want to delete: "+b)&&(console.log("Deleting design: "+b),k(b),a.find("option[value="+b+"]").remove()),!1}),b}function o(a){var b=$("<button>Save Current Design</button>");return b.click(function(){var b=$(a).find(":selected").val(),c=b||(new Date).toLocaleString(),d=prompt("Name this design!",c);return j(d)&&m(a,d),!1}),b}function p(){var b=$("<button>Share</button>");return b.click(function(b){b.preventDefault();var c=f(),d=document.createElement("a");d.href=document.URL,d.hash=encodeURIComponent(c);var e='<div>Copy the link below, and share it with your friends</div><div><strong>NOTE:</strong> only suit options, and measurements are shared</div><div><input type="text" size="75" value="'+d.href+'"></div>';return a({description:e}),!1}),b}function q(){var a=window.location.hash.replace(/^#/,"");if(a.length>0){var b,c=decodeURIComponent(a);try{b=JSON.parse(c)}catch(d){}b&&(console.log("Detected shared design. Attempting to load..."),g(b,!0))}var e=!1;if($("link").each(function(a,b){var c=$(b).attr("href");(-1!==c.indexOf("vss.css")||-1!==c.indexOf("vss.min.css"))&&(e=!0)}),!e){var f=document.createElement("link");f.setAttribute("rel","stylesheet"),f.setAttribute("type","text/css"),f.setAttribute("href",r),document.body.appendChild(f)}}var r="http://vss.greg.lu/vss.min.css",s="vss-"+$("#item_suitModel :selected").val()+"::",t=$("#content"),u=t.find("#panel_options,#panel_measurements"),v="#panel_options",w=$(v),x="vss-designs";if(b()){var y=l(x),z=n(y),A=o(y),B=p(),C=$('<div id="vss" class="form_submit clearfix">').append(A).append(B).append(y).append(z);$("#content .form_submit").before(C),q()}else alert("Vertical Suit Saver seems to be out-of-date. Womp womp.")}();